{"ast":null,"code":"import{Navigate,useLocation}from\"react-router-dom\";import{useAuth}from\"./AuthContext\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function RequireAuth(_ref){let{children}=_ref;const{user,profile,loading}=useAuth();const location=useLocation();// 1. Wait for AuthContext to finish\nif(loading){return/*#__PURE__*/_jsx(\"div\",{style:{padding:50,textAlign:'center'},children:\"Loading application...\"});}// 2. If no user, go to Login\nif(!user){return/*#__PURE__*/_jsx(Navigate,{to:\"/login\",state:{from:location},replace:true});}// 3. ✅ CRITICAL FIX: If User exists but Profile is missing, STOP HERE.\n// This prevents the \"White Screen\" crash in Navbar/Sidebar.\nif(!profile){return/*#__PURE__*/_jsxs(\"div\",{style:{padding:40,textAlign:\"center\",color:\"#d00\"},children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u26A0\\uFE0F Profile Error\"}),/*#__PURE__*/_jsx(\"p\",{children:\"User is logged in, but we could not load your profile data.\"}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Debug Info:\"}),\" User ID: \",user.id]}),/*#__PURE__*/_jsx(\"p\",{children:\"Possible causes: Internet issues, RLS Policies, or Database connection.\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>window.location.reload(),style:{padding:\"10px 20px\",cursor:\"pointer\",marginTop:20},children:\"Retry Connection\"})]});}// 4. Safe to render Dashboard\nreturn children;}","map":{"version":3,"names":["Navigate","useLocation","useAuth","jsx","_jsx","jsxs","_jsxs","RequireAuth","_ref","children","user","profile","loading","location","style","padding","textAlign","to","state","from","replace","color","id","onClick","window","reload","cursor","marginTop"],"sources":["/home/steve/amala/client/src/auth/RequireAuth.js"],"sourcesContent":["import { Navigate, useLocation } from \"react-router-dom\";\nimport { useAuth } from \"./AuthContext\";\n\nexport default function RequireAuth({ children }) {\n  const { user, profile, loading } = useAuth();\n  const location = useLocation();\n\n  // 1. Wait for AuthContext to finish\n  if (loading) {\n    return <div style={{ padding: 50, textAlign: 'center' }}>Loading application...</div>;\n  }\n\n  // 2. If no user, go to Login\n  if (!user) {\n    return <Navigate to=\"/login\" state={{ from: location }} replace />;\n  }\n\n  // 3. ✅ CRITICAL FIX: If User exists but Profile is missing, STOP HERE.\n  // This prevents the \"White Screen\" crash in Navbar/Sidebar.\n  if (!profile) {\n    return (\n      <div style={{ padding: 40, textAlign: \"center\", color: \"#d00\" }}>\n        <h2>⚠️ Profile Error</h2>\n        <p>User is logged in, but we could not load your profile data.</p>\n        <p><strong>Debug Info:</strong> User ID: {user.id}</p>\n        <p>Possible causes: Internet issues, RLS Policies, or Database connection.</p>\n        <button \n          onClick={() => window.location.reload()}\n          style={{ padding: \"10px 20px\", cursor: \"pointer\", marginTop: 20 }}\n        >\n          Retry Connection\n        </button>\n      </div>\n    );\n  }\n\n  // 4. Safe to render Dashboard\n  return children;\n}"],"mappings":"AAAA,OAASA,QAAQ,CAAEC,WAAW,KAAQ,kBAAkB,CACxD,OAASC,OAAO,KAAQ,eAAe,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAExC,cAAe,SAAS,CAAAC,WAAWA,CAAAC,IAAA,CAAe,IAAd,CAAEC,QAAS,CAAC,CAAAD,IAAA,CAC9C,KAAM,CAAEE,IAAI,CAAEC,OAAO,CAAEC,OAAQ,CAAC,CAAGV,OAAO,CAAC,CAAC,CAC5C,KAAM,CAAAW,QAAQ,CAAGZ,WAAW,CAAC,CAAC,CAE9B;AACA,GAAIW,OAAO,CAAE,CACX,mBAAOR,IAAA,QAAKU,KAAK,CAAE,CAAEC,OAAO,CAAE,EAAE,CAAEC,SAAS,CAAE,QAAS,CAAE,CAAAP,QAAA,CAAC,wBAAsB,CAAK,CAAC,CACvF,CAEA;AACA,GAAI,CAACC,IAAI,CAAE,CACT,mBAAON,IAAA,CAACJ,QAAQ,EAACiB,EAAE,CAAC,QAAQ,CAACC,KAAK,CAAE,CAAEC,IAAI,CAAEN,QAAS,CAAE,CAACO,OAAO,MAAE,CAAC,CACpE,CAEA;AACA;AACA,GAAI,CAACT,OAAO,CAAE,CACZ,mBACEL,KAAA,QAAKQ,KAAK,CAAE,CAAEC,OAAO,CAAE,EAAE,CAAEC,SAAS,CAAE,QAAQ,CAAEK,KAAK,CAAE,MAAO,CAAE,CAAAZ,QAAA,eAC9DL,IAAA,OAAAK,QAAA,CAAI,4BAAgB,CAAI,CAAC,cACzBL,IAAA,MAAAK,QAAA,CAAG,6DAA2D,CAAG,CAAC,cAClEH,KAAA,MAAAG,QAAA,eAAGL,IAAA,WAAAK,QAAA,CAAQ,aAAW,CAAQ,CAAC,aAAU,CAACC,IAAI,CAACY,EAAE,EAAI,CAAC,cACtDlB,IAAA,MAAAK,QAAA,CAAG,yEAAuE,CAAG,CAAC,cAC9EL,IAAA,WACEmB,OAAO,CAAEA,CAAA,GAAMC,MAAM,CAACX,QAAQ,CAACY,MAAM,CAAC,CAAE,CACxCX,KAAK,CAAE,CAAEC,OAAO,CAAE,WAAW,CAAEW,MAAM,CAAE,SAAS,CAAEC,SAAS,CAAE,EAAG,CAAE,CAAAlB,QAAA,CACnE,kBAED,CAAQ,CAAC,EACN,CAAC,CAEV,CAEA;AACA,MAAO,CAAAA,QAAQ,CACjB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}