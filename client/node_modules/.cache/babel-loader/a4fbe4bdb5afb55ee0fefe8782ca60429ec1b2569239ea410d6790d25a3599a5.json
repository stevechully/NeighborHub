{"ast":null,"code":"var _jsxFileName = \"/home/steve/amala/client/src/auth/AuthContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport { createContext, useContext, useEffect, useState } from \"react\";\nimport { supabase } from \"../lib/supabase\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthContext = /*#__PURE__*/createContext(null);\nexport function AuthProvider({\n  children\n}) {\n  _s();\n  const [user, setUser] = useState(null);\n  const [profile, setProfile] = useState(null);\n  const [loading, setLoading] = useState(true);\n  async function loadProfile(userId) {\n    const {\n      data,\n      error\n    } = await supabase.from(\"profiles\").select(\"*, roles(name)\").eq(\"id\", userId).single();\n    if (error) {\n      console.error(\"profile error\", error);\n      return null;\n    }\n    return data;\n  }\n  useEffect(() => {\n    let mounted = true;\n    async function initializeAuth() {\n      try {\n        console.log(\"AuthContext: Starting initialization...\");\n\n        // 1. Explicitly check for an existing session on mount\n        const {\n          data: {\n            session\n          },\n          error: sessionError\n        } = await supabase.auth.getSession();\n        if (sessionError) {\n          console.error(\"AuthContext: Session fetch error:\", sessionError);\n        }\n        if (mounted) {\n          var _session$user;\n          const sessionUser = (_session$user = session === null || session === void 0 ? void 0 : session.user) !== null && _session$user !== void 0 ? _session$user : null;\n          console.log(\"AuthContext: Initial session user:\", (sessionUser === null || sessionUser === void 0 ? void 0 : sessionUser.email) || \"none\");\n          setUser(sessionUser);\n          if (sessionUser) {\n            console.log(\"AuthContext: Fetching profile (non-blocking)...\");\n            // ðŸ’¡ Don't await profile load here to avoid blocking the UI\n            loadProfile(sessionUser.id).then(p => {\n              if (mounted) {\n                console.log(\"AuthContext: Profile loaded successfully\");\n                setProfile(p);\n              }\n            }).catch(err => {\n              console.error(\"AuthContext: Profile load failed intermittently:\", err);\n            });\n          }\n        }\n      } catch (err) {\n        console.error(\"AuthContext: Unexpected initialization error:\", err);\n      } finally {\n        if (mounted) {\n          console.log(\"AuthContext: Initialization flow complete, setting loading=false\");\n          setLoading(false);\n        }\n      }\n    }\n    initializeAuth();\n\n    // 2. Listen for subsequent auth state changes (login, logout, etc.)\n    const {\n      data: {\n        subscription\n      }\n    } = supabase.auth.onAuthStateChange(async (event, session) => {\n      var _session$user2;\n      console.log(`AuthContext: Auth event fired: ${event}`);\n      if (!mounted) return;\n      const sessionUser = (_session$user2 = session === null || session === void 0 ? void 0 : session.user) !== null && _session$user2 !== void 0 ? _session$user2 : null;\n      setUser(sessionUser);\n      if (sessionUser) {\n        loadProfile(sessionUser.id).then(p => {\n          if (mounted) setProfile(p);\n        });\n      } else {\n        setProfile(null);\n      }\n      setLoading(false);\n    });\n    return () => {\n      mounted = false;\n      subscription.unsubscribe();\n    };\n  }, []);\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      user,\n      profile,\n      loading\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 98,\n    columnNumber: 5\n  }, this);\n}\n_s(AuthProvider, \"DYSpA4ZauWKW8e4CNkO4ayA+RbM=\");\n_c = AuthProvider;\nexport function useAuth() {\n  _s2();\n  return useContext(AuthContext);\n}\n_s2(useAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["createContext","useContext","useEffect","useState","supabase","jsxDEV","_jsxDEV","AuthContext","AuthProvider","children","_s","user","setUser","profile","setProfile","loading","setLoading","loadProfile","userId","data","error","from","select","eq","single","console","mounted","initializeAuth","log","session","sessionError","auth","getSession","_session$user","sessionUser","email","id","then","p","catch","err","subscription","onAuthStateChange","event","_session$user2","unsubscribe","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","useAuth","_s2","$RefreshReg$"],"sources":["/home/steve/amala/client/src/auth/AuthContext.js"],"sourcesContent":["import { createContext, useContext, useEffect, useState } from \"react\";\nimport { supabase } from \"../lib/supabase\";\n\nconst AuthContext = createContext(null);\n\nexport function AuthProvider({ children }) {\n  const [user, setUser] = useState(null);\n  const [profile, setProfile] = useState(null);\n  const [loading, setLoading] = useState(true);\n\n  async function loadProfile(userId) {\n    const { data, error } = await supabase\n      .from(\"profiles\")\n      .select(\"*, roles(name)\")\n      .eq(\"id\", userId)\n      .single();\n\n    if (error) {\n      console.error(\"profile error\", error);\n      return null;\n    }\n    return data;\n  }\n\n  useEffect(() => {\n    let mounted = true;\n\n\n    async function initializeAuth() {\n      try {\n        console.log(\"AuthContext: Starting initialization...\");\n\n        // 1. Explicitly check for an existing session on mount\n        const { data: { session }, error: sessionError } = await supabase.auth.getSession();\n\n        if (sessionError) {\n          console.error(\"AuthContext: Session fetch error:\", sessionError);\n        }\n\n        if (mounted) {\n          const sessionUser = session?.user ?? null;\n          console.log(\"AuthContext: Initial session user:\", sessionUser?.email || \"none\");\n          setUser(sessionUser);\n\n          if (sessionUser) {\n            console.log(\"AuthContext: Fetching profile (non-blocking)...\");\n            // ðŸ’¡ Don't await profile load here to avoid blocking the UI\n            loadProfile(sessionUser.id).then(p => {\n              if (mounted) {\n                console.log(\"AuthContext: Profile loaded successfully\");\n                setProfile(p);\n              }\n            }).catch(err => {\n              console.error(\"AuthContext: Profile load failed intermittently:\", err);\n            });\n          }\n        }\n      } catch (err) {\n        console.error(\"AuthContext: Unexpected initialization error:\", err);\n      } finally {\n        if (mounted) {\n          console.log(\"AuthContext: Initialization flow complete, setting loading=false\");\n          setLoading(false);\n        }\n      }\n    }\n\n    initializeAuth();\n\n    // 2. Listen for subsequent auth state changes (login, logout, etc.)\n    const { data: { subscription } } = supabase.auth.onAuthStateChange(\n      async (event, session) => {\n        console.log(`AuthContext: Auth event fired: ${event}`);\n        if (!mounted) return;\n\n        const sessionUser = session?.user ?? null;\n        setUser(sessionUser);\n\n        if (sessionUser) {\n          loadProfile(sessionUser.id).then(p => {\n            if (mounted) setProfile(p);\n          });\n        } else {\n          setProfile(null);\n        }\n\n        setLoading(false);\n      }\n    );\n\n    return () => {\n      mounted = false;\n      subscription.unsubscribe();\n    };\n  }, []);\n\n  return (\n    <AuthContext.Provider value={{ user, profile, loading }}>\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nexport function useAuth() {\n  return useContext(AuthContext);\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}