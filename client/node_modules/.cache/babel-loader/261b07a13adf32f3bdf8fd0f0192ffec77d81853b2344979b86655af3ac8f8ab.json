{"ast":null,"code":"import { supabase } from \"../lib/supabase\";\nconst API_BASE = process.env.REACT_APP_API_BASE_URL || \"http://localhost:4000\";\nexport async function apiFetch(path, options = {}) {\n  var _data$session;\n  const {\n    data\n  } = await supabase.auth.getSession();\n  const token = data === null || data === void 0 ? void 0 : (_data$session = data.session) === null || _data$session === void 0 ? void 0 : _data$session.access_token;\n  if (!token) {\n    throw new Error(\"Missing auth token. Please login again.\");\n  }\n  const res = await fetch(`${API_BASE}${path}`, {\n    ...options,\n    headers: {\n      \"Content-Type\": \"application/json\",\n      \"Authorization\": `Bearer ${token}`,\n      ...(options.headers || {}) // This allows you to override headers if needed\n    }\n  });\n\n  // Handle empty responses (204 No Content) safely\n  if (res.status === 204) return null;\n  const json = await res.json().catch(() => null);\n  if (!res.ok) {\n    // If the server sends a specific error message, use it; otherwise, use status text\n    throw new Error((json === null || json === void 0 ? void 0 : json.error) || (json === null || json === void 0 ? void 0 : json.message) || `Error ${res.status}: ${res.statusText}`);\n  }\n  return json;\n}","map":{"version":3,"names":["supabase","API_BASE","process","env","REACT_APP_API_BASE_URL","apiFetch","path","options","_data$session","data","auth","getSession","token","session","access_token","Error","res","fetch","headers","status","json","catch","ok","error","message","statusText"],"sources":["/home/steve/amala/client/src/api/client.js"],"sourcesContent":["import { supabase } from \"../lib/supabase\";\n\nconst API_BASE = process.env.REACT_APP_API_BASE_URL || \"http://localhost:4000\";\n\nexport async function apiFetch(path, options = {}) {\n  const { data } = await supabase.auth.getSession();\n  const token = data?.session?.access_token;\n\n  if (!token) {\n    throw new Error(\"Missing auth token. Please login again.\");\n  }\n\n  const res = await fetch(`${API_BASE}${path}`, {\n    ...options,\n    headers: {\n      \"Content-Type\": \"application/json\",\n      \"Authorization\": `Bearer ${token}`,\n      ...(options.headers || {}), // This allows you to override headers if needed\n    },\n  });\n\n  // Handle empty responses (204 No Content) safely\n  if (res.status === 204) return null;\n\n  const json = await res.json().catch(() => null);\n\n  if (!res.ok) {\n    // If the server sends a specific error message, use it; otherwise, use status text\n    throw new Error(json?.error || json?.message || `Error ${res.status}: ${res.statusText}`);\n  }\n\n  return json;\n}"],"mappings":"AAAA,SAASA,QAAQ,QAAQ,iBAAiB;AAE1C,MAAMC,QAAQ,GAAGC,OAAO,CAACC,GAAG,CAACC,sBAAsB,IAAI,uBAAuB;AAE9E,OAAO,eAAeC,QAAQA,CAACC,IAAI,EAAEC,OAAO,GAAG,CAAC,CAAC,EAAE;EAAA,IAAAC,aAAA;EACjD,MAAM;IAAEC;EAAK,CAAC,GAAG,MAAMT,QAAQ,CAACU,IAAI,CAACC,UAAU,CAAC,CAAC;EACjD,MAAMC,KAAK,GAAGH,IAAI,aAAJA,IAAI,wBAAAD,aAAA,GAAJC,IAAI,CAAEI,OAAO,cAAAL,aAAA,uBAAbA,aAAA,CAAeM,YAAY;EAEzC,IAAI,CAACF,KAAK,EAAE;IACV,MAAM,IAAIG,KAAK,CAAC,yCAAyC,CAAC;EAC5D;EAEA,MAAMC,GAAG,GAAG,MAAMC,KAAK,CAAC,GAAGhB,QAAQ,GAAGK,IAAI,EAAE,EAAE;IAC5C,GAAGC,OAAO;IACVW,OAAO,EAAE;MACP,cAAc,EAAE,kBAAkB;MAClC,eAAe,EAAE,UAAUN,KAAK,EAAE;MAClC,IAAIL,OAAO,CAACW,OAAO,IAAI,CAAC,CAAC,CAAC,CAAE;IAC9B;EACF,CAAC,CAAC;;EAEF;EACA,IAAIF,GAAG,CAACG,MAAM,KAAK,GAAG,EAAE,OAAO,IAAI;EAEnC,MAAMC,IAAI,GAAG,MAAMJ,GAAG,CAACI,IAAI,CAAC,CAAC,CAACC,KAAK,CAAC,MAAM,IAAI,CAAC;EAE/C,IAAI,CAACL,GAAG,CAACM,EAAE,EAAE;IACX;IACA,MAAM,IAAIP,KAAK,CAAC,CAAAK,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEG,KAAK,MAAIH,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEI,OAAO,KAAI,SAASR,GAAG,CAACG,MAAM,KAAKH,GAAG,CAACS,UAAU,EAAE,CAAC;EAC3F;EAEA,OAAOL,IAAI;AACb","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}