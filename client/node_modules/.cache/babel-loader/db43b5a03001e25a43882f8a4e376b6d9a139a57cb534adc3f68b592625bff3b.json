{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import{useParams,useNavigate}from\"react-router-dom\";import{fetchFacilities,fetchFacilityBookingsByDate,bookFacility}from\"../../api/facilities.api\";import{generateSlots,isSlotBooked}from\"../../utils/slotHelpers\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function FacilityDetails(){const{id}=useParams();const navigate=useNavigate();const[facility,setFacility]=useState(null);const[selectedDate,setSelectedDate]=useState(\"\");const[bookings,setBookings]=useState([]);const[loading,setLoading]=useState(true);// 1. Fetch Facility Data\nuseEffect(()=>{async function loadFacility(){try{const data=await fetchFacilities();const found=data.find(f=>f.id===id);setFacility(found);}catch(err){alert(\"Error loading facility\");}finally{setLoading(false);}}loadFacility();},[id]);// 2. Fetch existing bookings when date or ID changes\nuseEffect(()=>{async function loadBookings(){try{const data=await fetchFacilityBookingsByDate(id,selectedDate);setBookings(data||[]);}catch(err){console.error(\"Failed to fetch bookings\",err);}}if(selectedDate&&id){loadBookings();}},[selectedDate,id]);const handleBooking=async slot=>{try{const payload={start_time:slot.start.toISOString(),end_time:slot.end.toISOString()};const result=await bookFacility(id,payload);if(result.status===\"RESERVED\"){alert(\"Slot Reserved! Redirecting to your bookings to pay...\");navigate(\"/facilities/bookings\");}else{alert(\"Booking Confirmed! ✅\");// To refresh slots after booking, we'd need to call loadBookings again.\n// A simple way is to just trigger the useEffect by re-setting the date\nconst currentDate=selectedDate;setSelectedDate(\"\");setTimeout(()=>setSelectedDate(currentDate),10);}}catch(err){alert(err.message||\"Booking failed\");}};if(loading)return/*#__PURE__*/_jsx(\"div\",{style:{padding:20},children:\"Loading facility details...\"});if(!facility)return/*#__PURE__*/_jsx(\"div\",{style:{padding:20},children:\"Facility not found.\"});const slots=selectedDate?generateSlots(facility.open_time,facility.close_time,60,selectedDate):[];return/*#__PURE__*/_jsxs(\"div\",{style:{padding:20},children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate(-1),style:{marginBottom:20},children:\"\\u2190 Back to Facilities\"}),/*#__PURE__*/_jsx(\"h2\",{children:facility.name}),/*#__PURE__*/_jsx(\"p\",{children:facility.description}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Fee:\"}),\" \",facility.is_paid?\"\\u20B9\".concat(facility.fee):\"Free\"]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:20},children:[/*#__PURE__*/_jsx(\"label\",{children:/*#__PURE__*/_jsx(\"strong\",{children:\"Select Date: \"})}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",min:new Date().toISOString().split(\"T\")[0],value:selectedDate,onChange:e=>setSelectedDate(e.target.value),style:{padding:8,borderRadius:5,border:\"1px solid #ccc\"}})]}),/*#__PURE__*/_jsx(\"div\",{style:{display:\"grid\",gridTemplateColumns:\"repeat(auto-fill, minmax(160px, 1fr))\",gap:12},children:selectedDate&&slots.map((slot,index)=>{const booked=isSlotBooked(slot,bookings);return/*#__PURE__*/_jsxs(\"button\",{disabled:booked,onClick:()=>handleBooking(slot),style:{padding:\"15px\",cursor:booked?\"not-allowed\":\"pointer\",backgroundColor:booked?\"#eee\":\"#4CAF50\",color:booked?\"#999\":\"white\",border:\"1px solid #ccc\",borderRadius:\"8px\",fontWeight:\"bold\"},children:[slot.start.toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'}),booked&&/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'10px',fontWeight:'normal'},children:\"Unavailable\"})]},index);})}),!selectedDate&&/*#__PURE__*/_jsx(\"p\",{style:{color:\"#666\",backgroundColor:\"#f9f9f9\",padding:15,borderRadius:8},children:\"Please select a date above to view available time slots.\"})]});}","map":{"version":3,"names":["React","useEffect","useState","useParams","useNavigate","fetchFacilities","fetchFacilityBookingsByDate","bookFacility","generateSlots","isSlotBooked","jsx","_jsx","jsxs","_jsxs","FacilityDetails","id","navigate","facility","setFacility","selectedDate","setSelectedDate","bookings","setBookings","loading","setLoading","loadFacility","data","found","find","f","err","alert","loadBookings","console","error","handleBooking","slot","payload","start_time","start","toISOString","end_time","end","result","status","currentDate","setTimeout","message","style","padding","children","slots","open_time","close_time","onClick","marginBottom","name","description","is_paid","concat","fee","type","min","Date","split","value","onChange","e","target","borderRadius","border","display","gridTemplateColumns","gap","map","index","booked","disabled","cursor","backgroundColor","color","fontWeight","toLocaleTimeString","hour","minute","fontSize"],"sources":["/home/steve/amala/client/src/pages/facilities/FacilityDetails.js"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { useParams, useNavigate } from \"react-router-dom\";\nimport { \n  fetchFacilities, \n  fetchFacilityBookingsByDate, \n  bookFacility \n} from \"../../api/facilities.api\";\nimport { generateSlots, isSlotBooked } from \"../../utils/slotHelpers\";\n\nexport default function FacilityDetails() {\n  const { id } = useParams();\n  const navigate = useNavigate();\n\n  \n  const [facility, setFacility] = useState(null);\n  const [selectedDate, setSelectedDate] = useState(\"\");\n  const [bookings, setBookings] = useState([]);\n  const [loading, setLoading] = useState(true);\n\n  // 1. Fetch Facility Data\n  useEffect(() => {\n    async function loadFacility() {\n      try {\n        const data = await fetchFacilities();\n        const found = data.find((f) => f.id === id);\n        setFacility(found);\n      } catch (err) {\n        alert(\"Error loading facility\");\n      } finally {\n        setLoading(false);\n      }\n    }\n    loadFacility();\n  }, [id]);\n\n  // 2. Fetch existing bookings when date or ID changes\n  useEffect(() => {\n    async function loadBookings() {\n      try {\n        const data = await fetchFacilityBookingsByDate(id, selectedDate);\n        setBookings(data || []);\n      } catch (err) {\n        console.error(\"Failed to fetch bookings\", err);\n      }\n    }\n\n    if (selectedDate && id) {\n      loadBookings();\n    }\n  }, [selectedDate, id]);\n\n  const handleBooking = async (slot) => {\n    try {\n      const payload = {\n        start_time: slot.start.toISOString(),\n        end_time: slot.end.toISOString()\n      };\n\n      const result = await bookFacility(id, payload);\n      \n      if (result.status === \"RESERVED\") {\n        alert(\"Slot Reserved! Redirecting to your bookings to pay...\");\n        navigate(\"/facilities/bookings\"); \n      } else {\n        alert(\"Booking Confirmed! ✅\");\n        // To refresh slots after booking, we'd need to call loadBookings again.\n        // A simple way is to just trigger the useEffect by re-setting the date\n        const currentDate = selectedDate;\n        setSelectedDate(\"\");\n        setTimeout(() => setSelectedDate(currentDate), 10);\n      }\n    } catch (err) {\n      alert(err.message || \"Booking failed\");\n    }\n  };\n\n  if (loading) return <div style={{ padding: 20 }}>Loading facility details...</div>;\n  if (!facility) return <div style={{ padding: 20 }}>Facility not found.</div>;\n\n  const slots = selectedDate \n    ? generateSlots(facility.open_time, facility.close_time, 60, selectedDate) \n    : [];\n\n  return (\n    <div style={{ padding: 20 }}>\n      <button onClick={() => navigate(-1)} style={{ marginBottom: 20 }}>\n        ← Back to Facilities\n      </button>\n\n      <h2>{facility.name}</h2>\n      <p>{facility.description}</p>\n      <p><strong>Fee:</strong> {facility.is_paid ? `₹${facility.fee}` : \"Free\"}</p>\n\n      <div style={{ marginBottom: 20 }}>\n        <label><strong>Select Date: </strong></label>\n        <input\n          type=\"date\"\n          min={new Date().toISOString().split(\"T\")[0]}\n          value={selectedDate}\n          onChange={(e) => setSelectedDate(e.target.value)}\n          style={{ padding: 8, borderRadius: 5, border: \"1px solid #ccc\" }}\n        />\n      </div>\n\n      <div style={{ \n        display: \"grid\", \n        gridTemplateColumns: \"repeat(auto-fill, minmax(160px, 1fr))\", \n        gap: 12 \n      }}>\n        {selectedDate && slots.map((slot, index) => {\n          const booked = isSlotBooked(slot, bookings);\n          return (\n            <button\n              key={index}\n              disabled={booked}\n              onClick={() => handleBooking(slot)}\n              style={{\n                padding: \"15px\",\n                cursor: booked ? \"not-allowed\" : \"pointer\",\n                backgroundColor: booked ? \"#eee\" : \"#4CAF50\",\n                color: booked ? \"#999\" : \"white\",\n                border: \"1px solid #ccc\",\n                borderRadius: \"8px\",\n                fontWeight: \"bold\"\n              }}\n            >\n              {slot.start.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\n              {booked && <div style={{ fontSize: '10px', fontWeight: 'normal' }}>Unavailable</div>}\n            </button>\n          );\n        })}\n      </div>\n      \n      {!selectedDate && (\n        <p style={{ color: \"#666\", backgroundColor: \"#f9f9f9\", padding: 15, borderRadius: 8 }}>\n          Please select a date above to view available time slots.\n        </p>\n      )}\n    </div>\n  );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}