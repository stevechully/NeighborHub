{"ast":null,"code":"import{useEffect,useState}from\"react\";import{useAuth}from\"../../auth/AuthContext\";import{fetchFacilityBookings,updateFacilityBookingStatus}from\"../../api/facilities.api\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function FacilityBookingsPage(){var _profile$roles,_profile$user_roles;const{profile,loading:authLoading}=useAuth();const roleName=(profile===null||profile===void 0?void 0:(_profile$roles=profile.roles)===null||_profile$roles===void 0?void 0:_profile$roles.name)||(profile===null||profile===void 0?void 0:profile.role)||(profile===null||profile===void 0?void 0:(_profile$user_roles=profile.user_roles)===null||_profile$user_roles===void 0?void 0:_profile$user_roles.role)||null;const isAdmin=roleName===\"ADMIN\";const[bookings,setBookings]=useState([]);const[loading,setLoading]=useState(true);async function loadBookings(){try{setLoading(true);const data=await fetchFacilityBookings();setBookings(data||[]);}catch(err){console.log(\"❌ Facility bookings fetch failed:\",err.message);alert(err.message);}finally{setLoading(false);}}useEffect(()=>{if(!authLoading&&profile){loadBookings();}// eslint-disable-next-line\n},[authLoading,profile]);async function handleUpdateStatus(id,status){try{await updateFacilityBookingStatus(id,status);alert(\"Booking \".concat(status,\" \\u2705\"));await loadBookings();}catch(err){alert(err.message);}}if(authLoading||!profile){return/*#__PURE__*/_jsx(\"div\",{style:{padding:40,textAlign:\"center\"},children:/*#__PURE__*/_jsx(\"p\",{children:\"Verifying session...\"})});}return/*#__PURE__*/_jsxs(\"div\",{style:{padding:20},children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Facility Bookings\"}),/*#__PURE__*/_jsx(\"button\",{onClick:loadBookings,style:{marginBottom:16},children:\"Refresh\"}),loading?/*#__PURE__*/_jsx(\"p\",{children:\"Loading bookings...\"}):bookings.length===0?/*#__PURE__*/_jsx(\"p\",{children:\"No bookings found.\"}):/*#__PURE__*/_jsxs(\"table\",{width:\"100%\",cellPadding:\"10\",style:{borderCollapse:\"collapse\"},children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{style:{background:\"#f3f3f3\"},children:[/*#__PURE__*/_jsx(\"th\",{align:\"left\",children:\"Facility\"}),/*#__PURE__*/_jsx(\"th\",{align:\"left\",children:\"Start\"}),/*#__PURE__*/_jsx(\"th\",{align:\"left\",children:\"End\"}),/*#__PURE__*/_jsx(\"th\",{align:\"left\",children:\"Status\"}),/*#__PURE__*/_jsx(\"th\",{align:\"left\",children:\"Actions\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:bookings.map(b=>{var _b$facilities;return/*#__PURE__*/_jsxs(\"tr\",{style:{borderBottom:\"1px solid #eee\"},children:[/*#__PURE__*/_jsx(\"td\",{children:((_b$facilities=b.facilities)===null||_b$facilities===void 0?void 0:_b$facilities.name)||b.facility_id}),/*#__PURE__*/_jsx(\"td\",{children:new Date(b.start_time).toLocaleString()}),/*#__PURE__*/_jsx(\"td\",{children:new Date(b.end_time).toLocaleString()}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"strong\",{children:b.status})}),/*#__PURE__*/_jsx(\"td\",{children:isAdmin?/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\",gap:10},children:[/*#__PURE__*/_jsx(\"button\",{disabled:b.status!==\"PENDING\",onClick:()=>handleUpdateStatus(b.id,\"APPROVED\"),children:\"Approve\"}),/*#__PURE__*/_jsx(\"button\",{disabled:b.status===\"CANCELLED\",onClick:()=>handleUpdateStatus(b.id,\"CANCELLED\"),children:\"Cancel\"})]}):/*#__PURE__*/_jsx(\"span\",{style:{color:\"#777\"},children:\"No actions\"})})]},b.id);})})]})]});}","map":{"version":3,"names":["useEffect","useState","useAuth","fetchFacilityBookings","updateFacilityBookingStatus","jsx","_jsx","jsxs","_jsxs","FacilityBookingsPage","_profile$roles","_profile$user_roles","profile","loading","authLoading","roleName","roles","name","role","user_roles","isAdmin","bookings","setBookings","setLoading","loadBookings","data","err","console","log","message","alert","handleUpdateStatus","id","status","concat","style","padding","textAlign","children","onClick","marginBottom","length","width","cellPadding","borderCollapse","background","align","map","b","_b$facilities","borderBottom","facilities","facility_id","Date","start_time","toLocaleString","end_time","display","gap","disabled","color"],"sources":["/home/steve/amala/client/src/pages/facilities/FacilityBookingsPage.js"],"sourcesContent":["import { useEffect, useState } from \"react\";\nimport { useAuth } from \"../../auth/AuthContext\";\nimport {\n  fetchFacilityBookings,\n  updateFacilityBookingStatus,\n} from \"../../api/facilities.api\";\n\nexport default function FacilityBookingsPage() {\n  const { profile, loading: authLoading } = useAuth();\n\n  const roleName =\n    profile?.roles?.name || profile?.role || profile?.user_roles?.role || null;\n\n  const isAdmin = roleName === \"ADMIN\";\n\n  const [bookings, setBookings] = useState([]);\n  const [loading, setLoading] = useState(true);\n\n  async function loadBookings() {\n    try {\n      setLoading(true);\n      const data = await fetchFacilityBookings();\n      setBookings(data || []);\n    } catch (err) {\n      console.log(\"❌ Facility bookings fetch failed:\", err.message);\n      alert(err.message);\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  useEffect(() => {\n    if (!authLoading && profile) {\n      loadBookings();\n    }\n    // eslint-disable-next-line\n  }, [authLoading, profile]);\n\n  async function handleUpdateStatus(id, status) {\n    try {\n      await updateFacilityBookingStatus(id, status);\n      alert(`Booking ${status} ✅`);\n      await loadBookings();\n    } catch (err) {\n      alert(err.message);\n    }\n  }\n\n  if (authLoading || !profile) {\n    return (\n      <div style={{ padding: 40, textAlign: \"center\" }}>\n        <p>Verifying session...</p>\n      </div>\n    );\n  }\n\n  return (\n    <div style={{ padding: 20 }}>\n      <h2>Facility Bookings</h2>\n\n      <button onClick={loadBookings} style={{ marginBottom: 16 }}>\n        Refresh\n      </button>\n\n      {loading ? (\n        <p>Loading bookings...</p>\n      ) : bookings.length === 0 ? (\n        <p>No bookings found.</p>\n      ) : (\n        <table width=\"100%\" cellPadding=\"10\" style={{ borderCollapse: \"collapse\" }}>\n          <thead>\n            <tr style={{ background: \"#f3f3f3\" }}>\n              <th align=\"left\">Facility</th>\n              <th align=\"left\">Start</th>\n              <th align=\"left\">End</th>\n              <th align=\"left\">Status</th>\n              <th align=\"left\">Actions</th>\n            </tr>\n          </thead>\n\n          <tbody>\n            {bookings.map((b) => (\n              <tr key={b.id} style={{ borderBottom: \"1px solid #eee\" }}>\n                <td>{b.facilities?.name || b.facility_id}</td>\n                <td>{new Date(b.start_time).toLocaleString()}</td>\n                <td>{new Date(b.end_time).toLocaleString()}</td>\n                <td>\n                  <strong>{b.status}</strong>\n                </td>\n\n                <td>\n                  {isAdmin ? (\n                    <div style={{ display: \"flex\", gap: 10 }}>\n                      <button\n                        disabled={b.status !== \"PENDING\"}\n                        onClick={() => handleUpdateStatus(b.id, \"APPROVED\")}\n                      >\n                        Approve\n                      </button>\n\n                      <button\n                        disabled={b.status === \"CANCELLED\"}\n                        onClick={() => handleUpdateStatus(b.id, \"CANCELLED\")}\n                      >\n                        Cancel\n                      </button>\n                    </div>\n                  ) : (\n                    <span style={{ color: \"#777\" }}>No actions</span>\n                  )}\n                </td>\n              </tr>\n            ))}\n          </tbody>\n        </table>\n      )}\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}