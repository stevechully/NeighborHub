{"ast":null,"code":"import _objectSpread from\"/home/steve/amala/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{supabase}from\"../lib/supabase\";const API_BASE=process.env.REACT_APP_API_BASE_URL||\"http://localhost:4000\";export async function apiFetch(path){var _data$session;let options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};const{data}=await supabase.auth.getSession();const token=data===null||data===void 0?void 0:(_data$session=data.session)===null||_data$session===void 0?void 0:_data$session.access_token;if(!token){throw new Error(\"Missing auth token. Please login again.\");}const res=await fetch(\"\".concat(API_BASE).concat(path),_objectSpread(_objectSpread({},options),{},{headers:_objectSpread({\"Content-Type\":\"application/json\",\"Authorization\":\"Bearer \".concat(token)},options.headers||{})}));// Handle empty responses (204 No Content) safely\nif(res.status===204)return null;const json=await res.json().catch(()=>null);if(!res.ok){// If the server sends a specific error message, use it; otherwise, use status text\nthrow new Error((json===null||json===void 0?void 0:json.error)||(json===null||json===void 0?void 0:json.message)||\"Error \".concat(res.status,\": \").concat(res.statusText));}return json;}","map":{"version":3,"names":["supabase","API_BASE","process","env","REACT_APP_API_BASE_URL","apiFetch","path","_data$session","options","arguments","length","undefined","data","auth","getSession","token","session","access_token","Error","res","fetch","concat","_objectSpread","headers","status","json","catch","ok","error","message","statusText"],"sources":["/home/steve/amala/client/src/api/client.js"],"sourcesContent":["import { supabase } from \"../lib/supabase\";\n\nconst API_BASE = process.env.REACT_APP_API_BASE_URL || \"http://localhost:4000\";\n\nexport async function apiFetch(path, options = {}) {\n  const { data } = await supabase.auth.getSession();\n  const token = data?.session?.access_token;\n\n  if (!token) {\n    throw new Error(\"Missing auth token. Please login again.\");\n  }\n\n  const res = await fetch(`${API_BASE}${path}`, {\n    ...options,\n    headers: {\n      \"Content-Type\": \"application/json\",\n      \"Authorization\": `Bearer ${token}`,\n      ...(options.headers || {}), // This allows you to override headers if needed\n    },\n  });\n\n  // Handle empty responses (204 No Content) safely\n  if (res.status === 204) return null;\n\n  const json = await res.json().catch(() => null);\n\n  if (!res.ok) {\n    // If the server sends a specific error message, use it; otherwise, use status text\n    throw new Error(json?.error || json?.message || `Error ${res.status}: ${res.statusText}`);\n  }\n\n  return json;\n}"],"mappings":"6GAAA,OAASA,QAAQ,KAAQ,iBAAiB,CAE1C,KAAM,CAAAC,QAAQ,CAAGC,OAAO,CAACC,GAAG,CAACC,sBAAsB,EAAI,uBAAuB,CAE9E,MAAO,eAAe,CAAAC,QAAQA,CAACC,IAAI,CAAgB,KAAAC,aAAA,IAAd,CAAAC,OAAO,CAAAC,SAAA,CAAAC,MAAA,IAAAD,SAAA,MAAAE,SAAA,CAAAF,SAAA,IAAG,CAAC,CAAC,CAC/C,KAAM,CAAEG,IAAK,CAAC,CAAG,KAAM,CAAAZ,QAAQ,CAACa,IAAI,CAACC,UAAU,CAAC,CAAC,CACjD,KAAM,CAAAC,KAAK,CAAGH,IAAI,SAAJA,IAAI,kBAAAL,aAAA,CAAJK,IAAI,CAAEI,OAAO,UAAAT,aAAA,iBAAbA,aAAA,CAAeU,YAAY,CAEzC,GAAI,CAACF,KAAK,CAAE,CACV,KAAM,IAAI,CAAAG,KAAK,CAAC,yCAAyC,CAAC,CAC5D,CAEA,KAAM,CAAAC,GAAG,CAAG,KAAM,CAAAC,KAAK,IAAAC,MAAA,CAAIpB,QAAQ,EAAAoB,MAAA,CAAGf,IAAI,EAAAgB,aAAA,CAAAA,aAAA,IACrCd,OAAO,MACVe,OAAO,CAAAD,aAAA,EACL,cAAc,CAAE,kBAAkB,CAClC,eAAe,WAAAD,MAAA,CAAYN,KAAK,CAAE,EAC9BP,OAAO,CAACe,OAAO,EAAI,CAAC,CAAC,CAC1B,EACF,CAAC,CAEF;AACA,GAAIJ,GAAG,CAACK,MAAM,GAAK,GAAG,CAAE,MAAO,KAAI,CAEnC,KAAM,CAAAC,IAAI,CAAG,KAAM,CAAAN,GAAG,CAACM,IAAI,CAAC,CAAC,CAACC,KAAK,CAAC,IAAM,IAAI,CAAC,CAE/C,GAAI,CAACP,GAAG,CAACQ,EAAE,CAAE,CACX;AACA,KAAM,IAAI,CAAAT,KAAK,CAAC,CAAAO,IAAI,SAAJA,IAAI,iBAAJA,IAAI,CAAEG,KAAK,IAAIH,IAAI,SAAJA,IAAI,iBAAJA,IAAI,CAAEI,OAAO,YAAAR,MAAA,CAAaF,GAAG,CAACK,MAAM,OAAAH,MAAA,CAAKF,GAAG,CAACW,UAAU,CAAE,CAAC,CAC3F,CAEA,MAAO,CAAAL,IAAI,CACb","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}